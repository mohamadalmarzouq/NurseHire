// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  CARETAKER
  ADMIN
}

enum CareTakerStatus {
  PENDING
  APPROVED
  REJECTED
}

enum RequestStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum BannerPosition {
  HOMEPAGE_HERO
  DASHBOARD_HEADER
}

enum ReviewStatus {
  PENDING
  APPROVED
  REJECTED
}

enum SubscriptionStatus {
  NONE
  ACTIVE
  EXPIRED
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  role      UserRole
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Subscription fields
  subscriptionStatus SubscriptionStatus @default(NONE)
  subscriptionStartDate DateTime?
  subscriptionEndDate   DateTime?
  subscriptionAmount    Decimal?        @db.Decimal(10, 2)

  // Relations
  userProfile      UserProfile?
  caretakerProfile CareTakerProfile?
  adminProfile     AdminProfile?

  // Chat relations
  sentMessages     Message[] @relation("MessageSender")
  receivedMessages Message[] @relation("MessageReceiver")

  // Information request relations
  sentRequests     InformationRequest[] @relation("InformationRequester")
  receivedRequests InformationRequest[] @relation("InformationCaretaker")

  // Review relations
  reviewsGiven   Review[] @relation("ReviewGiver")
  reviewsReceived Review[] @relation("ReviewReceiver")

  @@map("users")
}

model UserProfile {
  id        String   @id @default(cuid())
  userId    String   @unique
  name      String
  phone     String?
  location  String?
  aboutMe   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profiles")
}

model CareTakerProfile {
  id                    String          @id @default(cuid())
  userId                String          @unique
  name                  String
  age                   Int
  phone                 String?
  location              String?
  totalExperience       Int
  kuwaitExperience      Int
  gccExperience         Int             @default(0)
  partTimeSalary        Int
  fullTimeSalary        Int             @default(0)
  expectedSalary        Int?
  maritalStatus         String?
  aboutMe               String?
  cvUrl                 String?
  profileImageUrl       String?
  certifications        String[]        @default([])
  status                CareTakerStatus @default(PENDING)
  languages             String[]        @default([])
  skills                String[]        @default([])
  availability          String[]        @default([])
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("caretaker_profiles")
}

model AdminProfile {
  id        String   @id @default(cuid())
  userId    String   @unique
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("admin_profiles")
}

model Message {
  id        String   @id @default(cuid())
  senderId  String
  receiverId String
  content   String
  fileUrl   String?
  read      Boolean  @default(false)
  createdAt DateTime @default(now())

  sender   User @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@map("messages")
}

model InformationRequest {
  id          String        @id @default(cuid())
  requesterId String
  caretakerId String
  status      RequestStatus @default(PENDING)
  message     String
  phone       String?
  preferredContactTime String?
  urgency     String?       // LOW, MEDIUM, HIGH
  adminNotes  String?       // Admin can add notes
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  requester User @relation("InformationRequester", fields: [requesterId], references: [id], onDelete: Cascade)
  caretaker User @relation("InformationCaretaker", fields: [caretakerId], references: [id], onDelete: Cascade)

  @@map("information_requests")
}

model Review {
  id          String      @id @default(cuid())
  giverId     String
  receiverId  String
  appearance  Int         // 1-5 stars
  attitude    Int         // 1-5 stars
  knowledge   Int         // 1-5 stars
  hygiene     Int         // 1-5 stars
  salary      Int         // 1-5 stars
  comment     String?
  status      ReviewStatus @default(PENDING)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  giver    User @relation("ReviewGiver", fields: [giverId], references: [id], onDelete: Cascade)
  receiver User @relation("ReviewReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([giverId, receiverId])
  @@map("reviews")
}

model BannerAd {
  id             String        @id @default(cuid())
  title          String
  imageUrl       String
  linkUrl        String?
  position       BannerPosition
  isActive       Boolean       @default(true)
  clickCount     Int           @default(0)
  impressionCount Int          @default(0)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@map("banner_ads")
}
